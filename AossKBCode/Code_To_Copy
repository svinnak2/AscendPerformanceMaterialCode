import xml.etree.ElementTree as ET
import os

# ✅ Define XML file path (Update with actual path)
xml_file_path = "/home/ec2/your-informatica.xml"
output_file_path = "/home/ec2/filtered_connectors.txt"

# ✅ Parse the XML file
try:
    tree = ET.parse(xml_file_path)
    root = tree.getroot()

    # ✅ Set to store unique (FROMINSTANCE, TOINSTANCETYPE) pairs
    unique_pairs = set()

    # ✅ Iterate through all <CONNECTOR> elements
    for connector in root.findall(".//CONNECTOR"):
        from_instance = connector.get("FROMINSTANCE")
        to_instance_type = connector.get("TOINSTANCETYPE")

        # ✅ Ensure values exist before adding to the set
        if from_instance and to_instance_type:
            unique_pairs.add((from_instance, to_instance_type))

    # ✅ Print and save unique pairs with quoted values
    if unique_pairs:
        with open(output_file_path, "w", encoding="utf-8") as output_file:
            for from_instance, to_instance_type in unique_pairs:
                line = f'FROMINSTANCE="{from_instance}", TOINSTANCETYPE="{to_instance_type}"'
                print(line)  # Print to console
                output_file.write(line + "\n")  # Save to file

        print(f"\n✅ Unique FROMINSTANCE & TOINSTANCETYPE pairs saved to: {output_file_path}")
    else:
        print("⚠️ No matching connectors found.")

except Exception as e:
    print(f"❌ Error processing XML file: {e}")
